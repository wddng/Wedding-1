<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scan Kehadiran</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body>
<h2>Scan QR Kehadiran</h2>
<div id="reader" style="width:300px"></div>
<p id="status"></p>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyAbFiLWZS5H1672SpouCn1deEAAn4qVqDs",
  databaseURL: "https://undanganwidi-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();

/* QR SCAN */
const qr = new Html5Qrcode("reader");

qr.start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  (decodedText) => {
    // hasil: id|nama
    const [idTamu, nama] = decodedText.split("|");

    if(!idTamu) return;

    db.ref("bukutamu/" + idTamu).update({
      hadir: true,
      waktuHadir: Date.now()
    });

    document.getElementById("status").innerHTML =
      "âœ… Kehadiran dicatat: <b>" + nama + "</b>";

    qr.stop();
  }
);
</script>
</body>
</html>
