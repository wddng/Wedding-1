<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scan QR Buku Tamu</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  font-family:Arial;
  text-align:center;
  padding:20px;
}
#reader{
  width:300px;
  margin:auto;
}
.status{
  margin-top:15px;
  font-size:16px;
}
.success{color:green}
.error{color:red}
</style>
</head>
<body>

<h2>üì∏ Scan QR Tamu</h2>
<div id="reader"></div>
<div id="status" class="status"></div>

<script>
firebase.initializeApp({
  apiKey: "ISI_APIKEY_KAMU",
  databaseURL: "ISI_DATABASE_URL"
});

const db = firebase.database();

function onScanSuccess(text){
  document.getElementById("status").innerHTML = "‚è≥ Memproses...";
  
  const data = text.split("|");
  if(data.length < 2){
    document.getElementById("status").innerHTML =
      "<span class='error'>QR tidak valid</span>";
    return;
  }

  const id = data[0];
  const nama = data[1];

  const ref = db.ref("bukutamu/" + id);

  ref.once("value").then(snap=>{
    if(snap.exists()){
      ref.update({
        status:"Hadir",
        waktuHadir:Date.now()
      });
      document.getElementById("status").innerHTML =
        "<span class='success'>‚úÖ Update hadir: "+nama+"</span>";
    }else{
      ref.set({
        nama:nama,
        status:"Hadir",
        pesan:"",
        waktuHadir:Date.now(),
        like:0
      });
      document.getElementById("status").innerHTML =
        "<span class='success'>üéâ Tamu baru: "+nama+"</span>";
    }
  });
}

const html5QrCode = new Html5Qrcode("reader");
html5QrCode.start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  onScanSuccess
);
</script>

</body>
</html>